<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <h1>上传文件</h1>
    <!-- <img src="./images/QQ图片20210814163118.jpg" alt=""> -->
    <input type="file" id="file" accept="image/*" multiple>
    <div style="margin: 5px 0;">上传进度</div>
    <div class="progress">
        <div class="progress-item"></div>
    </div>
    <p class="status"></p>
    <div class="imgdiv">
        <img src="" alt="" class="imgbox">
    </div>
    <div class="bbt">
        <button class="btn" style="display: none;">压缩</button>
    </div>
    <script>
        document
            .querySelector('#file')
            .addEventListener('change', function() {
                // File 对象 
                // es6以前是不可以的，文件属于系统 要上传到服务器端处理
                // html5 File 对象 文件能力 上传到服务器前 文件的大小
                var file = this.files[0]
                console.log(file, '----------');
                var fromdata = new FormData() // 表单数据
                fromdata.append("file", file)
                const xhr = new XMLHttpRequest()
                xhr.open("post", "http://localhost:6300/uploadPic/")
                xhr.onreadystatechange = function() {
                    if (xhr.readyState == 4 && xhr.status == 200) {
                        document.querySelector('.btn').style.display = 'block'
                        document.querySelector('.status').style.display = 'block'
                        document.querySelector('status').innerHTML = xhr.responseText

                    }
                }
                xhr.upload.onprogress = function(event) {
                    if (event.lengthComputable) {
                        let procent = event.loaded / event.total * 100
                        document.querySelector('#progress .progress-item')
                        .style
                        .width = procent + '%'
                    }
                }
                xhr.send(fromdata)
            })
        document.querySelector('.btn')
        .addEventListener('click', function() {
            document.querySelector('.status').innerHTML = '等待中'
            var xhr = new XMLHttpRequest()
            xhr.open('get','http://localhost:6300/zipimg/')
            xhr.send()
            xhr.onreadystatechange = function() {
                if (xhr.readyState == 4 && xhr.status == 200) {
                    
                }
            }
        })
    </script>
</body>
</html>